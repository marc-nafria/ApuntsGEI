<head>
    <link rel="stylesheet" href="../assets/style.css" />
</head>
<body class="light">
    <header class="page-header" role="banner">
        <div class="page-header-left">
            <h1 class="page-header-left"># Marc Nafria</h1>
        </div>
        <div class="page-header-right">
            <a
                href="https://marc-nafria.github.io/ApuntsGEI"
                class="header-button-gei"
                >ApuntsGEI</a
            >
            <button id="theme-switcher" class="switch-button">
                Switch Theme
            </button>
        </div>
    </header>
    <div class="container">
        <div id="table-of-contents" class="sidebar">
            <!-- Table of contents will be generated here -->
        </div>
        <main id="content" class="main-content" role="main">
            <h1 id="resum-del-segon-control-de-laboratori">
                Resum del segon Control de Laboratori
            </h1>

            <h2 id="sat-amb-costos">SAT amb costos</h2>

            <p>
                La idea de <strong>SAT</strong> amb costos es definir un
                predicat que donat un cost, escrigui les
                <strong>clausules</strong> necessàries per a que es compleixi.
                Després, iterarem de manera
                <strong>descendent en cost</strong> per a trobar la solució amb
                menys cost possible. Així, generem solucions del nostre problema
                de cost <strong>n-1</strong> en cada iteració fins que
                <em>kissat</em> retorni que és insatisfactible el model
                proposat.
            </p>

            <h3 id="exemple-min-coloring">Exemple: Min coloring</h3>

            <div class="language-prolog highlighter-rouge">
                <div class="highlight">
                    <pre
                        class="highlight"
                    ><code><span class="c1">%%%%%%% =======================================================================================</span>
<span class="c1">%</span>
<span class="c1">% Our LI Prolog template for solving problems using a SAT solver.</span>
<span class="c1">%</span>
<span class="c1">% It generates the SAT clauses, calls the SAT solver, shows the solution and computes its cost.</span>
<span class="c1">% Just specify:</span>
<span class="c1">%       1. SAT Variables</span>
<span class="c1">%       2. Clause generation</span>
<span class="c1">%       3. DisplaySol: show the solution.</span>
<span class="c1">%       4. CostOfThisSolution: computes the cost</span>
<span class="c1">%</span>
<span class="c1">%%%%%%% =======================================================================================</span>

<span class="ss">symbolicOutput</span><span class="p">(</span><span class="m">0</span><span class="p">).</span>  <span class="c1">% set to 1 for DEBUGGING: to see symbolic output only; 0 otherwise.</span>



<span class="c1">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="c1">%% Find the minimal number of colors needed to color a graph.</span>
<span class="c1">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>


<span class="c1">%%%%%%% Begin example input %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

<span class="ss">numNodes</span><span class="p">(</span><span class="m">15</span><span class="p">).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="p">[</span>  <span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span>    <span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">,</span><span class="m">13</span><span class="p">,</span><span class="m">14</span><span class="p">,</span><span class="m">15</span><span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span>  <span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span>  <span class="m">9</span><span class="p">,</span>   <span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">,</span>      <span class="m">15</span><span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span>  <span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">,</span>   <span class="m">12</span><span class="p">,</span><span class="m">13</span><span class="p">,</span><span class="m">14</span>   <span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span>  <span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span>  <span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">,</span><span class="m">13</span><span class="p">,</span>   <span class="m">15</span><span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span>    <span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">,</span>      <span class="m">12</span><span class="p">,</span><span class="m">13</span><span class="p">,</span>   <span class="m">15</span><span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span>      <span class="m">8</span><span class="p">,</span>  <span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span>         <span class="m">15</span><span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">7</span><span class="p">,</span> <span class="p">[</span>  <span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span>    <span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span>      <span class="m">14</span>   <span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">8</span><span class="p">,</span> <span class="p">[</span>    <span class="m">3</span><span class="p">,</span>  <span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span>  <span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">,</span>      <span class="m">13</span><span class="p">,</span><span class="m">14</span><span class="p">,</span><span class="m">15</span><span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">9</span><span class="p">,</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span>  <span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span>     <span class="m">11</span><span class="p">,</span>         <span class="m">15</span><span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">10</span><span class="p">,[</span><span class="m">1</span><span class="p">,</span>  <span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span>  <span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span>     <span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">,</span>   <span class="m">14</span><span class="p">,</span><span class="m">15</span><span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">11</span><span class="p">,[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span>  <span class="m">4</span><span class="p">,</span>  <span class="m">6</span><span class="p">,</span><span class="m">7</span><span class="p">,</span>  <span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">,</span>   <span class="m">12</span><span class="p">,</span><span class="m">13</span><span class="p">,</span><span class="m">14</span>   <span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">12</span><span class="p">,[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span>        <span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span>   <span class="m">13</span><span class="p">,</span><span class="m">14</span><span class="p">,</span><span class="m">15</span><span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">13</span><span class="p">,[</span><span class="m">1</span><span class="p">,</span>  <span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span>    <span class="m">8</span><span class="p">,</span>     <span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">,</span>   <span class="m">14</span><span class="p">,</span><span class="m">15</span><span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">14</span><span class="p">,[</span><span class="m">1</span><span class="p">,</span>  <span class="m">3</span><span class="p">,</span>      <span class="m">7</span><span class="p">,</span><span class="m">8</span><span class="p">,</span>  <span class="m">10</span><span class="p">,</span><span class="m">11</span><span class="p">,</span><span class="m">12</span><span class="p">,</span><span class="m">13</span><span class="p">,</span>   <span class="m">15</span><span class="p">]).</span>
<span class="ss">adjacency</span><span class="p">(</span><span class="m">15</span><span class="p">,[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">,</span>  <span class="m">4</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">6</span><span class="p">,</span>  <span class="m">8</span><span class="p">,</span><span class="m">9</span><span class="p">,</span><span class="m">10</span><span class="p">,</span>   <span class="m">12</span><span class="p">,</span><span class="m">13</span><span class="p">,</span><span class="m">14</span>   <span class="p">]).</span>

<span class="c1">%%%%%%% End example input %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>


<span class="c1">%%%%%%% Some helpful definitions to make the code cleaner: ====================================</span>

<span class="ss">node</span><span class="p">(</span><span class="nv">I</span><span class="p">):-</span>   <span class="ss">numNodes</span><span class="p">(</span><span class="nv">N</span><span class="p">),</span> <span class="ss">between</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="nv">N</span><span class="p">,</span><span class="nv">I</span><span class="p">).</span>
<span class="ss">edge</span><span class="p">(</span><span class="nv">I</span><span class="p">,</span><span class="nv">J</span><span class="p">):-</span> <span class="ss">adjacency</span><span class="p">(</span><span class="nv">I</span><span class="p">,</span><span class="nv">L</span><span class="p">),</span> <span class="ss">member</span><span class="p">(</span><span class="nv">J</span><span class="p">,</span><span class="nv">L</span><span class="p">).</span>
<span class="ss">color</span><span class="p">(</span><span class="nv">C</span><span class="p">):-</span>  <span class="ss">numNodes</span><span class="p">(</span><span class="nv">N</span><span class="p">),</span> <span class="ss">between</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="nv">N</span><span class="p">,</span><span class="nv">C</span><span class="p">).</span>

<span class="c1">%%%%%%% End helpful definitions ===============================================================</span>


<span class="c1">%%%%%%%  1. Declare SAT variables to be used: =================================================</span>

<span class="c1">% x(I,C)    meaning  "node I has color C"</span>
<span class="ss">satVariable</span><span class="p">(</span> <span class="ss">x</span><span class="p">(</span><span class="nv">I</span><span class="p">,</span><span class="nv">C</span><span class="p">)</span> <span class="p">):-</span> <span class="ss">node</span><span class="p">(</span><span class="nv">I</span><span class="p">),</span> <span class="ss">color</span><span class="p">(</span><span class="nv">C</span><span class="p">).</span>


<span class="c1">%%%%%%%  2. Clause generation for the SAT solver: =============================================</span>

<span class="c1">% This predicate writeClauses(MaxCost) generates the clauses that guarantee that</span>
<span class="c1">% a solution with cost at most MaxCost is found</span>

<span class="ss">writeClauses</span><span class="p">(</span><span class="ss">infinite</span><span class="p">):-</span> <span class="p">!,</span> <span class="ss">numNodes</span><span class="p">(</span><span class="nv">N</span><span class="p">),</span> <span class="ss">writeClauses</span><span class="p">(</span><span class="nv">N</span><span class="p">),!.</span>
<span class="ss">writeClauses</span><span class="p">(</span><span class="nv">MaxColors</span><span class="p">):-</span>
  <span class="ss">eachNodeExactlyOnecolor</span><span class="p">(</span><span class="nv">MaxColors</span><span class="p">),</span>
  <span class="ss">noAdjacentNodesWithSameColor</span><span class="p">(</span><span class="nv">MaxColors</span><span class="p">),</span>
  <span class="ss">true</span><span class="p">,!.</span>
<span class="ss">writeClauses</span><span class="p">(</span><span class="nv">_</span><span class="p">):-</span> <span class="ss">told</span><span class="p">,</span> <span class="ss">nl</span><span class="p">,</span> <span class="ss">write</span><span class="p">(</span><span class="ss">'writeClauses failed!'</span><span class="p">),</span> <span class="ss">nl</span><span class="p">,</span><span class="ss">nl</span><span class="p">,</span> <span class="ss">halt</span><span class="p">.</span>

<span class="ss">eachNodeExactlyOnecolor</span><span class="p">(</span><span class="nv">MaxColors</span><span class="p">):-</span> 
  <span class="ss">node</span><span class="p">(</span><span class="nv">I</span><span class="p">),</span> <span class="ss">findall</span><span class="p">(</span><span class="ss">x</span><span class="p">(</span><span class="nv">I</span><span class="p">,</span><span class="nv">C</span><span class="p">),</span> <span class="ss">between</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="nv">MaxColors</span><span class="p">,</span><span class="nv">C</span><span class="p">),</span> <span class="nv">Lits</span> <span class="p">),</span> <span class="ss">exactly</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="nv">Lits</span><span class="p">),</span> <span class="ss">fail</span><span class="p">.</span>
<span class="ss">eachNodeExactlyOnecolor</span><span class="p">(</span><span class="nv">_</span><span class="p">).</span>

<span class="ss">noAdjacentNodesWithSameColor</span><span class="p">(</span><span class="nv">MaxColors</span><span class="p">):-</span> 
  <span class="ss">edge</span><span class="p">(</span><span class="nv">I</span><span class="p">,</span><span class="nv">J</span><span class="p">),</span> <span class="ss">between</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="nv">MaxColors</span><span class="p">,</span><span class="nv">C</span><span class="p">),</span> <span class="ss">writeOneClause</span><span class="p">([</span> <span class="o">-</span><span class="ss">x</span><span class="p">(</span><span class="nv">I</span><span class="p">,</span><span class="nv">C</span><span class="p">),</span> <span class="o">-</span><span class="ss">x</span><span class="p">(</span><span class="nv">J</span><span class="p">,</span><span class="nv">C</span><span class="p">)</span> <span class="p">]),</span> <span class="ss">fail</span><span class="p">.</span>
<span class="ss">noAdjacentNodesWithSameColor</span><span class="p">(</span><span class="nv">_</span><span class="p">).</span>

<span class="c1">%%%%%%%  4. This predicate computes the cost of a given solution M: ===========================</span>

<span class="c1">% Here the sort predicate is used to remove repeated elements of the list:</span>
<span class="ss">costOfThisSolution</span><span class="p">(</span><span class="nv">M</span><span class="p">,</span><span class="nv">Cost</span><span class="p">):-</span> <span class="ss">findall</span><span class="p">(</span><span class="nv">C</span><span class="p">,</span><span class="ss">member</span><span class="p">(</span><span class="ss">x</span><span class="p">(</span><span class="nv">_</span><span class="p">,</span><span class="nv">C</span><span class="p">),</span><span class="nv">M</span><span class="p">),</span><span class="nv">L</span><span class="p">),</span> <span class="ss">sort</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span><span class="nv">L1</span><span class="p">),</span> <span class="ss">length</span><span class="p">(</span><span class="nv">L1</span><span class="p">,</span><span class="nv">Cost</span><span class="p">),</span> <span class="p">!.</span>
</code></pre>
                </div>
            </div>

            <p>
                Com podem veure, es tracta del problema de
                <strong>min coloring</strong>, en el que volem pintar els nodes
                de un graf sense que n’hi hagi dos adjacents del mateix color.
                Definim el <strong>cost</strong> de una solució com el nombre de
                colors necessaris diferents que necessitem per a complir les
                restriccions del problema. Aquí té molt sentit la existència del
                cost, ja que si no ens interesés la solució del problema podria
                ser sempre utilitzar un color diferent per a cada node.
            </p>

            <p>
                La línea
                <code class="language-plaintext highlighter-rouge"
                    >costOfThisSolution(M,Cost):- findall(C,member(x(_,C),M),L),
                    sort(L,L1), length(L1,Cost), !.</code
                >
                defineix el predicat de cost, que imposa que el cost de la
                solució es
                <strong>Cost</strong> sempre que la longitud de la llista sense
                repeticions (per això el
                <code class="language-plaintext highlighter-rouge"
                    >sort(L, L1</code
                >) dels colors utilitzats sigui de longitud
                <strong>Cost</strong>.
            </p>

            <p>
                El <strong>main</strong>, que no esta aquí, busca solucions de
                cost descendent fins que el problema es torna insatisfactible, i
                retorna la ultima solució factible.
            </p>

            <h3 id="exemple-factory">Exemple: Factory</h3>

            <div class="language-prolog highlighter-rouge">
                <div class="highlight">
                    <pre
                        class="highlight"
                    ><code><span class="c1">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="c1">%% We have a factory of concrete products (beams, walls, roofs) that</span>
<span class="c1">%% works permanently (168h/week).  Every week we plan our production</span>
<span class="c1">%% tasks for the following week.  For example, one task may be to produce</span>
<span class="c1">%% a concrete beam of a certain type, which takes 10 hours and requires</span>
<span class="c1">%% (always one single unit of) the following resources: platform, crane,</span>
<span class="c1">%% truck, mechanic, driver.  But there are only a limited amount of units</span>
<span class="c1">%% of each resource available. For example, we may have only 3 trucks.  We</span>
<span class="c1">%% have 168 hours (numbered from 1 to 168) for all tasks, but we want to</span>
<span class="c1">%% finish all tasks as soon as possible.</span>
<span class="c1">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>

<span class="ss">maxHour</span><span class="p">(</span><span class="m">168</span><span class="p">).</span>

<span class="c1">%% task( taskID, Duration, ListOFResourcesUsed ).</span>
<span class="ss">task</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">19</span><span class="p">,[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">]).</span>
<span class="ss">task</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">52</span><span class="p">,[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">]).</span>
<span class="ss">task</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">16</span><span class="p">,[</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">]).</span>
<span class="ss">task</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="m">52</span><span class="p">,[</span><span class="m">1</span><span class="p">,</span><span class="m">3</span><span class="p">]).</span>
<span class="ss">task</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">16</span><span class="p">,[</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">]).</span>
<span class="ss">task</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">20</span><span class="p">,[</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">]).</span>
<span class="ss">task</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="m">45</span><span class="p">,[</span><span class="m">2</span><span class="p">,</span><span class="m">3</span><span class="p">]).</span>

<span class="c1">%% resourceUnits( resourceID, NumUnitsAvailable ).</span>
<span class="ss">resourceUnits</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">).</span>
<span class="ss">resourceUnits</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">).</span>
<span class="ss">resourceUnits</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">2</span><span class="p">).</span>

<span class="c1">%%%%%%% Some helpful definitions to make the code cleaner: ====================================</span>

<span class="ss">task</span><span class="p">(</span><span class="nv">T</span><span class="p">):-</span>              <span class="ss">task</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span><span class="nv">_</span><span class="p">,</span><span class="nv">_</span><span class="p">).</span>
<span class="ss">duration</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span><span class="nv">D</span><span class="p">):-</span>        <span class="ss">task</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span><span class="nv">D</span><span class="p">,</span><span class="nv">_</span><span class="p">).</span>
<span class="ss">usesResource</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span><span class="nv">R</span><span class="p">):-</span>    <span class="ss">task</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span><span class="nv">_</span><span class="p">,</span><span class="nv">L</span><span class="p">),</span> <span class="ss">member</span><span class="p">(</span><span class="nv">R</span><span class="p">,</span><span class="nv">L</span><span class="p">).</span>

<span class="c1">%%%%%%%  1. Declare SAT variables to be used: =================================================</span>

<span class="ss">satVariable</span><span class="p">(</span> <span class="ss">start</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span><span class="nv">H</span><span class="p">)</span> <span class="p">):-</span> <span class="ss">task</span><span class="p">(</span><span class="nv">T</span><span class="p">),</span> <span class="ss">integer</span><span class="p">(</span><span class="nv">H</span><span class="p">).</span>   <span class="c1">% "task T starts at hour H"</span>
<span class="ss">satVariable</span><span class="p">(</span> <span class="ss">usage</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">H</span><span class="p">,</span> <span class="nv">R</span><span class="p">)</span> <span class="p">):-</span> <span class="ss">task</span><span class="p">(</span><span class="nv">T</span><span class="p">),</span> <span class="ss">integer</span><span class="p">(</span><span class="nv">H</span><span class="p">),</span> <span class="ss">integer</span><span class="p">(</span><span class="nv">R</span><span class="p">).</span> <span class="c1">% task T uses resource R in hour H</span>

<span class="c1">%%%%%%%  2. Clause generation for the SAT solver: =============================================</span>

<span class="c1">% This predicate writeClauses(MaxCost) generates the clauses that guarantee that</span>
<span class="c1">% a solution with cost at most MaxCost is found</span>

<span class="ss">writeClauses</span><span class="p">(</span><span class="ss">infinite</span><span class="p">):-</span> <span class="p">!,</span> <span class="ss">maxHour</span><span class="p">(</span><span class="nv">M</span><span class="p">),</span> <span class="ss">writeClauses</span><span class="p">(</span><span class="nv">M</span><span class="p">),!.</span>
<span class="ss">writeClauses</span><span class="p">(</span><span class="nv">MaxHours</span><span class="p">):-</span>
  <span class="ss">eachTaskStartsOnce</span><span class="p">(</span><span class="nv">MaxHours</span><span class="p">),</span>    <span class="c1">% fa la restriccio de cost tambe   </span>
  <span class="ss">implicacioResources</span><span class="p">(</span><span class="nv">MaxHours</span><span class="p">),</span>
  <span class="ss">resourcesMax</span><span class="p">,</span>
  <span class="ss">true</span><span class="p">,!.</span>
<span class="ss">writeClauses</span><span class="p">(</span><span class="nv">_</span><span class="p">):-</span> <span class="ss">told</span><span class="p">,</span> <span class="ss">nl</span><span class="p">,</span> <span class="ss">write</span><span class="p">(</span><span class="ss">'writeClauses failed!'</span><span class="p">),</span> <span class="ss">nl</span><span class="p">,</span><span class="ss">nl</span><span class="p">,</span> <span class="ss">halt</span><span class="p">.</span>


<span class="ss">horaIniciValida</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">H</span><span class="p">,</span> <span class="nv">MaxHours</span><span class="p">):-</span>
      <span class="ss">between</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="nv">MaxHours</span><span class="p">,</span> <span class="nv">H</span><span class="p">),</span>
      <span class="ss">duration</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">D</span><span class="p">),</span>
      <span class="nv">End</span> <span class="ss">is</span> <span class="nv">H</span> <span class="o">+</span> <span class="nv">D</span> <span class="o">-</span> <span class="m">1</span><span class="p">,</span>
      <span class="nv">End</span> <span class="o">=&lt;</span> <span class="nv">MaxHours</span><span class="p">.</span>


<span class="ss">eachTaskStartsOnce</span><span class="p">(</span><span class="ss">infinite</span><span class="p">):-!.</span>
<span class="ss">eachTaskStartsOnce</span><span class="p">(</span><span class="nv">MaxHours</span><span class="p">):-</span>
      <span class="ss">task</span><span class="p">(</span><span class="nv">T</span><span class="p">),</span>
      <span class="ss">findall</span><span class="p">(</span><span class="ss">start</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">H</span><span class="p">),</span> <span class="ss">horaIniciValida</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">H</span><span class="p">,</span> <span class="nv">MaxHours</span><span class="p">),</span> <span class="nv">Lits</span><span class="p">),</span> <span class="ss">exactly</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="nv">Lits</span><span class="p">),</span>
      <span class="ss">fail</span><span class="p">.</span>
<span class="ss">eachTaskStartsOnce</span><span class="p">(</span><span class="nv">_</span><span class="p">).</span>


<span class="c1">% Implication between a task's start time and its resource usage throughout its duration</span>
<span class="ss">implicacioResources</span><span class="p">(</span><span class="nv">MaxHours</span><span class="p">)</span> <span class="p">:-</span>
  <span class="ss">task</span><span class="p">(</span><span class="nv">T</span><span class="p">),</span>
  <span class="ss">horaIniciValida</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">Hini</span><span class="p">,</span> <span class="nv">MaxHours</span><span class="p">),</span>
  <span class="ss">duration</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">D</span><span class="p">),</span>
  <span class="nv">Hfi</span> <span class="ss">is</span> <span class="nv">Hini</span> <span class="o">+</span> <span class="nv">D</span><span class="p">,</span>
  <span class="ss">between</span><span class="p">(</span><span class="nv">Hini</span><span class="p">,</span> <span class="nv">Hfi</span><span class="p">,</span> <span class="nv">H</span><span class="p">),</span>
  <span class="ss">usesResource</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">R</span><span class="p">),</span>
  <span class="ss">writeOneClause</span><span class="p">([</span><span class="o">-</span><span class="ss">start</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">Hini</span><span class="p">),</span> <span class="ss">usage</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">H</span><span class="p">,</span> <span class="nv">R</span><span class="p">)]),</span>
  <span class="ss">fail</span><span class="p">.</span>
<span class="ss">implicacioResources</span><span class="p">(</span><span class="nv">_</span><span class="p">).</span>

<span class="c1">% Enforce constraints on resource usage within available limits per hour</span>
<span class="ss">resourcesMax</span> <span class="p">:-</span>
  <span class="ss">resourceUnits</span><span class="p">(</span><span class="nv">R</span><span class="p">,</span> <span class="nv">Units</span><span class="p">),</span>
  <span class="ss">maxHour</span><span class="p">(</span><span class="ss">mH</span><span class="p">),</span>
  <span class="ss">between</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="ss">maxHour</span><span class="p">,</span> <span class="nv">H</span><span class="p">),</span>
  <span class="ss">findall</span><span class="p">(</span><span class="ss">usage</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span> <span class="nv">H</span><span class="p">,</span> <span class="nv">R</span><span class="p">),</span> <span class="ss">task</span><span class="p">(</span><span class="nv">T</span><span class="p">),</span> <span class="nv">ResourceHourUsages</span><span class="p">),</span>
  <span class="ss">atMost</span><span class="p">(</span><span class="nv">Units</span><span class="p">,</span> <span class="nv">ResourceHourUsages</span><span class="p">),</span>
  <span class="ss">fail</span><span class="p">.</span>
<span class="ss">resourcesMax</span><span class="p">.</span>

<span class="c1">%%%%%%%  4. This predicate computes the cost of a given solution M: ===========================</span>

<span class="ss">costOfThisSolution</span><span class="p">(</span><span class="nv">M</span><span class="p">,</span><span class="nv">Cost</span><span class="p">):-</span> <span class="ss">findall</span><span class="p">(</span><span class="nv">End</span><span class="p">,</span> <span class="p">(</span> <span class="ss">member</span><span class="p">(</span><span class="ss">start</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span><span class="nv">H</span><span class="p">),</span><span class="nv">M</span><span class="p">),</span> <span class="ss">duration</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span><span class="nv">D</span><span class="p">),</span> <span class="nv">End</span> <span class="ss">is</span> <span class="nv">H</span><span class="o">+</span><span class="nv">D</span><span class="o">-</span><span class="m">1</span><span class="p">),</span> <span class="nv">L</span><span class="p">),</span>  <span class="ss">max_list</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span><span class="nv">Cost</span><span class="p">),!.</span>
</code></pre>
                </div>
            </div>

            <p>
                En aquest cas tenim un problema d’una fàbrica que fabrica tres
                tipus de productes diferents, i ho fa en tasques que utilitzen
                recursos limitats durant el temps en el que transcorren. La idea
                es definir una hora de inici valida per a cada tasca de tal
                manera que mai s’utilitzin més recursos dels que es tenen,
                <strong>minimitzant el temps total</strong>, definit com la hora
                de acabada de la ultima tasca. Les clausules defineixen en
                <strong>SAT</strong> les restriccions de consumició de recursos.
                Per a definir la <strong>restricció de cost</strong> tenim el
                següent.
            </p>

            <div class="language-prolog highlighter-rouge">
                <div class="highlight">
                    <pre
                        class="highlight"
                    ><code><span class="ss">costOfThisSolution</span><span class="p">(</span><span class="nv">M</span><span class="p">,</span><span class="nv">Cost</span><span class="p">):-</span> <span class="ss">findall</span><span class="p">(</span><span class="nv">End</span><span class="p">,</span> <span class="p">(</span> <span class="ss">member</span><span class="p">(</span><span class="ss">start</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span><span class="nv">H</span><span class="p">),</span><span class="nv">M</span><span class="p">),</span> <span class="ss">duration</span><span class="p">(</span><span class="nv">T</span><span class="p">,</span><span class="nv">D</span><span class="p">),</span> <span class="nv">End</span> <span class="ss">is</span> <span class="nv">H</span><span class="o">+</span><span class="nv">D</span><span class="o">-</span><span class="m">1</span><span class="p">),</span> <span class="nv">L</span><span class="p">),</span>  <span class="ss">max_list</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span><span class="nv">Cost</span><span class="p">),!.</span>
</code></pre>
                </div>
            </div>

            <p>
                El que fem es trobar totes del hores de inici de les tasques i
                guardar aquest valor sumat de la seva duració. Després, el cost
                es definit per el màxim de tots els elements trobats. De la
                mateixa manera que en el
                <strong>min coloring</strong>, el programa <em>main</em> iterarà
                en <strong>cost descendent</strong> fins a trobar model
                <strong>SAT</strong> insatisfactible, i retornarà la última
                solució factible.
            </p>

            <hr />

            <h2 id="prolog-avançat">Prolog avançat</h2>

            <p>
                Un dels problemes típics que trobarem serà el de trobar
                solucions a enunciats que segueixin la següent estructura,
                tenim:
            </p>

            <ul>
                <li>
                    <p>un <strong>Estat Inicial</strong>,</p>
                </li>
                <li>
                    <p>un <strong>Estat Final</strong> al que volem arribar</p>
                </li>
                <li>
                    <p>
                        i un seguit de <strong>pasos</strong> que porten d’un
                        estat a un altre, i que tenen un <strong>cost</strong>
                    </p>
                </li>
            </ul>

            <p>
                L’objectiu es trobar un <strong>camí</strong>, o
                <strong>conjunt de pasos</strong>, que ens portin del
                <strong>Estat Inicial</strong> al <strong>Estat Final</strong>,
                amb el menor <strong>cost</strong> possible.
            </p>

            <h3 id="exemple-problema-dels-ponts">
                Exemple: Problema dels ponts
            </h3>

            <div class="language-prolog highlighter-rouge">
                <div class="highlight">
                    <pre
                        class="highlight"
                    ><code><span class="c1">% Trata de averiguar la manera más rápida que tienen cuatro personas (P1, P2, P5 y P8)</span>
<span class="c1">% para cruzar de noche un puente que solo aguanta el peso de dos. Tienen una única e</span>
<span class="c1">% imprescindible linterna y cada Pi tarda i minutos en cruzar. Dos juntos tardan como</span>
<span class="c1">% el más lento de los dos.</span>

<span class="ss">main</span> <span class="p">:-</span> <span class="nv">EstadoInicial</span> <span class="o">=</span> <span class="p">[[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">8</span><span class="p">],</span> <span class="p">[],</span> <span class="m">0</span><span class="p">],</span> <span class="nv">EstadoFinal</span> <span class="o">=</span> <span class="p">[[],</span> <span class="p">[</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">8</span><span class="p">],</span> <span class="m">1</span><span class="p">],</span>
  <span class="ss">between</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">1000</span><span class="p">,</span> <span class="nv">CosteMax</span><span class="p">),</span> <span class="c1">% Buscamos soluci ́on de coste 0; si no, de 1, etc.</span>
  <span class="ss">camino</span><span class="p">(</span> <span class="nv">CosteMax</span><span class="p">,</span> <span class="nv">EstadoInicial</span><span class="p">,</span> <span class="nv">EstadoFinal</span><span class="p">,</span> <span class="p">[</span><span class="nv">EstadoInicial</span><span class="p">],</span> <span class="nv">Camino</span> <span class="p">),</span>
  <span class="ss">reverse</span><span class="p">(</span><span class="nv">Camino</span><span class="p">,</span> <span class="nv">Camino1</span><span class="p">),</span> <span class="ss">write</span><span class="p">(</span><span class="nv">Camino1</span><span class="p">),</span> <span class="ss">write</span><span class="p">(</span><span class="ss">' con coste '</span><span class="p">),</span> <span class="ss">write</span><span class="p">(</span><span class="nv">CosteMax</span><span class="p">),</span> <span class="ss">nl</span><span class="p">,</span> <span class="ss">halt</span><span class="p">.</span>

<span class="ss">camino</span><span class="p">(</span> <span class="m">0</span><span class="p">,</span> <span class="p">[[],</span> <span class="nv">_</span><span class="p">,</span> <span class="nv">_</span><span class="p">],</span> <span class="nv">_</span><span class="p">,</span> <span class="nv">C</span><span class="p">,</span><span class="nv">C</span> <span class="p">).</span>

<span class="ss">camino</span><span class="p">(</span> <span class="nv">CosteMax</span><span class="p">,</span> <span class="nv">EstadoActual</span><span class="p">,</span> <span class="nv">EstadoFinal</span><span class="p">,</span> <span class="nv">CaminoHastaAhora</span><span class="p">,</span> <span class="nv">CaminoTotal</span> <span class="p">)</span> <span class="p">:-</span>
  <span class="nv">CosteMax</span> <span class="o">&gt;</span> <span class="m">0</span><span class="p">,</span>
  <span class="ss">unPaso</span><span class="p">(</span> <span class="nv">CostePaso</span><span class="p">,</span> <span class="nv">EstadoActual</span><span class="p">,</span> <span class="nv">EstadoSiguiente</span> <span class="p">),</span> <span class="c1">% En B.1 y B.2, CostePaso es 1.</span>
  <span class="err">\</span><span class="o">+</span> <span class="ss">member</span><span class="p">(</span> <span class="nv">EstadoSiguiente</span><span class="p">,</span> <span class="nv">CaminoHastaAhora</span> <span class="p">),</span>
  <span class="nv">CosteMax1</span> <span class="ss">is</span> <span class="nv">CosteMax</span><span class="o">-</span><span class="nv">CostePaso</span><span class="p">,</span>
  <span class="ss">camino</span><span class="p">(</span><span class="nv">CosteMax1</span><span class="p">,</span> <span class="nv">EstadoSiguiente</span><span class="p">,</span> <span class="nv">EstadoFinal</span><span class="p">,</span> <span class="p">[</span><span class="nv">EstadoSiguiente</span><span class="p">|</span><span class="nv">CaminoHastaAhora</span><span class="p">],</span> <span class="nv">CaminoTotal</span><span class="p">).</span>

<span class="ss">maxim</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="nv">Y</span><span class="p">,</span> <span class="nv">R</span><span class="p">)</span> <span class="p">:-</span>
  <span class="nv">X</span> <span class="o">&gt;</span> <span class="nv">Y</span><span class="p">,</span>
  <span class="nv">R</span> <span class="ss">is</span> <span class="nv">X</span><span class="p">.</span>
<span class="ss">maxim</span><span class="p">(</span><span class="nv">X</span><span class="p">,</span> <span class="nv">Y</span><span class="p">,</span> <span class="nv">R</span><span class="p">)</span> <span class="p">:-</span>
  <span class="nv">X</span> <span class="o">=&lt;</span> <span class="nv">Y</span><span class="p">,</span>
  <span class="nv">R</span> <span class="ss">is</span> <span class="nv">Y</span><span class="p">.</span>

<span class="c1">% creuar el pont de esquerra a dreta, dues persones</span>
<span class="ss">unPaso</span><span class="p">(</span><span class="nv">Tiempo</span><span class="p">,</span> <span class="p">[</span><span class="nv">E0</span><span class="p">,</span> <span class="nv">D0</span><span class="p">,</span> <span class="m">0</span><span class="p">],</span> <span class="p">[</span><span class="nv">E1</span><span class="p">,</span> <span class="nv">D1</span><span class="p">,</span> <span class="m">1</span><span class="p">])</span> <span class="p">:-</span>
  <span class="ss">select</span><span class="p">(</span><span class="nv">P1</span><span class="p">,</span> <span class="nv">E0</span><span class="p">,</span> <span class="nv">RestaE0</span><span class="p">),</span>
  <span class="ss">select</span><span class="p">(</span><span class="nv">P2</span><span class="p">,</span> <span class="nv">RestaE0</span><span class="p">,</span> <span class="nv">E1</span><span class="p">),</span>    <span class="c1">% agafem dos persones de la esquerra i E1 val el que hi queda l'esquerra</span>
  <span class="ss">union</span><span class="p">(</span><span class="nv">D0</span><span class="p">,</span> <span class="p">[</span><span class="nv">P1</span><span class="p">,</span><span class="nv">P2</span><span class="p">],</span> <span class="nv">D1</span><span class="p">),</span>
  <span class="ss">maxim</span><span class="p">(</span><span class="nv">P1</span><span class="p">,</span> <span class="nv">P2</span><span class="p">,</span> <span class="nv">Tiempo</span><span class="p">).</span>

<span class="c1">% creuar el pont de dreta a esquerra</span>
<span class="ss">unPaso</span><span class="p">(</span><span class="nv">Tiempo</span><span class="p">,</span> <span class="p">[</span><span class="nv">E0</span><span class="p">,</span> <span class="nv">D0</span><span class="p">,</span> <span class="m">1</span><span class="p">],</span> <span class="p">[</span><span class="nv">E1</span><span class="p">,</span> <span class="nv">D1</span><span class="p">,</span> <span class="m">0</span><span class="p">])</span> <span class="p">:-</span>
  <span class="ss">select</span><span class="p">(</span><span class="nv">P1</span><span class="p">,</span> <span class="nv">D0</span><span class="p">,</span> <span class="nv">D1</span><span class="p">),</span>   <span class="c1">% torna algu [[],[2,5,8,1],1]]amb la llinterna</span>
  <span class="ss">union</span><span class="p">(</span><span class="nv">E0</span><span class="p">,</span> <span class="p">[</span><span class="nv">P1</span><span class="p">],</span> <span class="nv">E1</span><span class="p">),</span>
  <span class="nv">Tiempo</span> <span class="ss">is</span> <span class="nv">P1</span><span class="p">.</span>
</code></pre>
                </div>
            </div>

            <p>
                En aquest problema, 4 persones necessiten creuar un pont amb les
                següents restriccions:
            </p>

            <ul>
                <li>
                    <p>
                        Només poden creuar si van amb la llanterna (només n’hi
                        ha una)
                    </p>
                </li>
                <li>
                    <p>Poden creuar com a màxim dos a la vegada</p>
                </li>
                <li>
                    <p>
                        Cadascun te un temps de creuada, i si dos creuen junts,
                        el temps es el del mes lent
                    </p>
                </li>
            </ul>

            <p>
                El problema esta en quina es la manera mes rapida en que poden
                creuar tots el pont.
            </p>

            <p>
                Com veiem en el codi, el <em>main</em>, que ens ve definit al
                examen, implementa la lògica per trobar el seguit de pasos amb
                menys cost, i nosaltres hem de implementar:
            </p>

            <ul>
                <li>
                    <p>
                        l’ <strong>Estat Inicial</strong>: en aquest cas definim
                        una llista de llistes on s’indica
                        <code class="language-plaintext highlighter-rouge"
                            >[ llista_id_persones_esq_pont,
                            llista_id_persones_drt_pont,
                            posicio_lliterna(0-&gt;esq, 1-&gt;drt) ]</code
                        >. Al principi, tant les persones com la llanterna estan
                        a la banda esquerra del pont, o sigui que encara no ha
                        creuat:
                        <code class="language-plaintext highlighter-rouge"
                            >[ [1, 2, 4, 8], [], 0 ]</code
                        >.
                    </p>
                </li>
                <li>
                    <p>
                        l’ <strong>Estat Final</strong>: el nostre estat final
                        serà aquell on tothom hagi creuat, i, per lògica, la
                        llanterna estigui a la banda dreta del pont:
                        <code class="language-plaintext highlighter-rouge"
                            >[ [], [1, 2, 4, 8], 1 ]</code
                        >.
                    </p>
                </li>
            </ul>

            <blockquote>
                <p>
                    Hem de veure que per motius de eficiència el
                    <code class="language-plaintext highlighter-rouge"
                        >id_persona</code
                    >
                    es també el temps que tarden a creuar el pont:
                    <code class="language-plaintext highlighter-rouge"
                        >1, 2, 4, 8</code
                    >
                </p>
            </blockquote>

            <p>
                Ara, només ens falta definir el predicat
                <code class="language-plaintext highlighter-rouge">unPaso</code>
                que pren tres àtoms:
            </p>

            <ul>
                <li>
                    <p>
                        <strong>Tiempo</strong>: expressa el cost d’aquell pas
                    </p>
                </li>
                <li>
                    <p>
                        <strong>Estat Anterior</strong>: Estat abans de aplicar
                        el pas
                    </p>
                </li>
                <li>
                    <p><strong>Estat Posterior</strong>: Estat posterior</p>
                </li>
            </ul>

            <p>
                Bàsicament, el que estem dient es: anar d´aquest estat a aquest
                altre es un pas i te aquest cost si… i formules les condicions
                per a que o siguin. En l’exemple proposat, el pas de creuar el
                pont d’esquerra a dreta es compleix i te cost
                <strong>Tiempo</strong> si:
            </p>

            <ul>
                <li>
                    <p>
                        Han creuat <strong>una</strong> o
                        <strong>dues</strong> persones com a molt.
                    </p>
                </li>
                <li>
                    <p>
                        La llanterna estava a l’esquerra i ara a la dreta
                        (<strong>0 =&gt; 1</strong>).
                        <em
                            >Hem de veure que això ve donat en els estats en la
                            definició del pas</em
                        >.
                    </p>
                </li>
                <li>
                    <p>
                        <strong>Tiempo</strong> ha de ser el màxim dels
                        <code class="language-plaintext highlighter-rouge"
                            >id_persona</code
                        >
                        que hagin creuat.
                    </p>
                </li>
            </ul>

            <p>
                Si això es compleix, el que ha passat entre un estat i l’altre
                es un
                <strong>pas</strong>, i pot formar part de la
                <strong>solució</strong>.
            </p>

            <blockquote>
                <p>
                    Per acabar, el pas de creuar de dreta esquerra es el mateix
                    que d’esquerra a dreta, però no contempla la possibilitat de
                    que creuïn dues persones ja que no te gaire sentit i mai
                    serà part de la solució. També canvia que la llanterna ha de
                    estar a la dreta en el primer estat i a l’esquerra en el
                    segon (<strong>1 =&gt; 0</strong>).
                </p>
            </blockquote>

            <hr />

            <h2 id="clp">CLP</h2>

            <p>
                Tenim un conjunt de <strong>restriccions</strong> ,
                <strong>variables</strong> i
                <strong>un domini per a cada variable</strong>.
                <strong>L’objectiu</strong> es trobar valors per a les
                variables, cada un del domini corresponent, tal que es
                satisfacin les <strong>restriccions</strong>.
            </p>

            <blockquote>
                <p>
                    SAT es un <em>Contraint Problem</em>, on les variables tenen
                    totes el domini {0,1} i les restriccions son les clausules.
                </p>
            </blockquote>

            <p><strong>Com s’han de resoldre?</strong></p>

            <ul>
                <li>
                    <p>
                        <img
                            class="emoji"
                            title=":no_entry_sign:"
                            alt=":no_entry_sign:"
                            src="https://github.githubassets.com/images/icons/emoji/unicode/1f6ab.png"
                            height="20"
                            width="20"
                        />
                        Generació i després test
                    </p>
                </li>
                <li>
                    <p>
                        <img
                            class="emoji"
                            title=":white_check_mark:"
                            alt=":white_check_mark:"
                            src="https://github.githubassets.com/images/icons/emoji/unicode/2705.png"
                            height="20"
                            width="20"
                        />
                        Entrellaçar la <strong>generació</strong> i el
                        <strong>test</strong>
                    </p>
                </li>
            </ul>

            <p>
                Per a millor la eficiència, podem provocar un efecte de
                <strong>propagació</strong>,
                <strong
                    >eliminant elements dels dominis de les variables</strong
                >
                que sabem segur que no poden ser part de cap solució.
            </p>

            <table>
                <thead>
                    <tr>
                        <th>Variables</th>
                        <th>Constriccions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>x in {1..10}</td>
                        <td>x &lt; y</td>
                    </tr>
                    <tr>
                        <td>y in {1..8}</td>
                        <td>z = x + y + 1</td>
                    </tr>
                    <tr>
                        <td>z in {1..8}</td>
                        <td></td>
                    </tr>
                </tbody>
            </table>

            <p><strong>Propagació inicial:</strong></p>

            <ul>
                <li>
                    <p>
                        <strong>x</strong>: <strong>1 2 3 4 5</strong>
                        <del>6 7 8 9 10</del>
                    </p>
                </li>
                <li>
                    <p>
                        <strong>y</strong>: <del>1</del>
                        <strong>2 3 4 5 6</strong>
                        <del>7 8</del>
                    </p>
                </li>
                <li>
                    <p>
                        <strong>z</strong>: <del>1 2 3</del>
                        <strong>4 5 6 7 8</strong>
                    </p>
                </li>
            </ul>

            <div class="language-prolog highlighter-rouge">
                <div class="highlight">
                    <pre
                        class="highlight"
                    ><code><span class="p">:-</span> <span class="ss">use_module</span><span class="p">(</span> <span class="ss">library</span><span class="p">(</span><span class="ss">clpfd</span><span class="p">)</span> <span class="p">).</span>


<span class="nv">P</span> <span class="p">:-</span> <span class="ss">x</span> <span class="ss">in</span> <span class="m">1</span><span class="p">..</span><span class="m">10</span><span class="p">,</span>                    <span class="c1">% 1. Definim els dominis de les variables        </span>
  <span class="p">[</span><span class="ss">y</span><span class="p">,</span> <span class="ss">z</span><span class="p">]</span> <span class="ss">ins</span> <span class="m">1</span><span class="p">..</span><span class="m">8</span><span class="p">,</span>                <span class="c1">%</span>

  <span class="ss">x</span> <span class="o">#&lt;</span> <span class="ss">y</span><span class="p">,</span>                         <span class="c1">% 2. Definim les constriccions</span>
  <span class="ss">z</span> <span class="o">#=</span> <span class="ss">x</span> <span class="o">+</span> <span class="ss">y</span> <span class="o">+</span> <span class="m">1</span><span class="p">,</span>                 <span class="c1">% </span>

  <span class="ss">label</span> <span class="p">(</span> <span class="p">[</span><span class="ss">x</span><span class="p">,</span> <span class="ss">y</span><span class="p">,</span> <span class="ss">z</span><span class="p">]),</span>             <span class="c1">% 3. Resolem amb backtracking</span>

  <span class="ss">write</span> <span class="p">([</span><span class="ss">x</span><span class="p">,</span> <span class="ss">y</span><span class="p">,</span> <span class="ss">z</span><span class="p">)),</span> <span class="ss">ln</span><span class="p">,</span> <span class="ss">halt</span><span class="p">.</span>    <span class="c1">% 4. Escriure la solucio</span>
</code></pre>
                </div>
            </div>

            <h3 id="exemple-magic">Exemple: Magic</h3>

            <div class="language-prolog highlighter-rouge">
                <div class="highlight">
                    <pre
                        class="highlight"
                    ><code><span class="p">:-</span> <span class="ss">use_module</span><span class="p">(</span><span class="ss">library</span><span class="p">(</span><span class="ss">clpfd</span><span class="p">)).</span>

<span class="c1">% Complete the following program p(N) that writes a (kind of) magic</span>
<span class="c1">% square: an NxN matrix with ALL the numbers 1..N^2, such that the</span>
<span class="c1">% sum of every row and every column is equal.</span>
<span class="c1">% More precisely, this sum is (N + N^3) / 2.</span>
<span class="c1">% Note: don't worry if your program is (too) slow when N &gt;= 6.</span>

<span class="c1">%% Example:  (this solution is not unique):</span>
<span class="c1">%%</span>
<span class="c1">%%    1   2  13  24  25</span>
<span class="c1">%%    3   8  18  17  19</span>
<span class="c1">%%   16  14  15   9  11</span>
<span class="c1">%%   22  20   7  10   6</span>
<span class="c1">%%   23  21  12   5   4</span>

<span class="ss">main</span><span class="p">:-</span> <span class="ss">p</span><span class="p">(</span><span class="m">5</span><span class="p">),</span> <span class="ss">nl</span><span class="p">,</span> <span class="ss">halt</span><span class="p">.</span>

<span class="ss">p</span><span class="p">(</span><span class="nv">N</span><span class="p">):-</span>

<span class="c1">% 1.</span>
  <span class="nv">NSquare</span> <span class="ss">is</span> <span class="nv">N</span><span class="o">*</span><span class="nv">N</span><span class="p">,</span>
  <span class="ss">length</span><span class="p">(</span> <span class="nv">Vars</span><span class="p">,</span> <span class="nv">NSquare</span> <span class="p">),</span>

  <span class="nv">Vars</span> <span class="ss">ins</span> <span class="m">1</span><span class="p">..</span><span class="nv">NSquare</span><span class="p">,</span>

<span class="c1">% 2. </span>
  <span class="ss">all_distinct</span><span class="p">(</span><span class="nv">Vars</span><span class="p">),</span>
  <span class="ss">squareByRows</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="nv">Vars</span><span class="p">,</span><span class="nv">SquareByRows</span><span class="p">),</span>
  <span class="ss">transpose</span><span class="p">(</span> <span class="nv">SquareByRows</span><span class="p">,</span> <span class="nv">SquareByCols</span> <span class="p">),</span>  <span class="c1">% transpose already exists: no need to implement it</span>

  <span class="nv">Sum</span> <span class="ss">is</span> <span class="p">(</span><span class="nv">N</span> <span class="o">+</span> <span class="nv">N</span><span class="o">*</span><span class="nv">N</span><span class="o">*</span><span class="nv">N</span><span class="p">)</span> <span class="o">//</span> <span class="m">2</span><span class="p">,</span> 
  <span class="ss">constraintsSum</span><span class="p">(</span> <span class="nv">Sum</span><span class="p">,</span> <span class="nv">SquareByRows</span><span class="p">),</span>
  <span class="ss">constraintsSum</span><span class="p">(</span> <span class="nv">Sum</span><span class="p">,</span> <span class="nv">SquareByCols</span><span class="p">),</span>

<span class="c1">% 3.</span>
  <span class="ss">label</span><span class="p">(</span><span class="nv">Vars</span><span class="p">),</span>

<span class="c1">% 4.</span>
  <span class="ss">writeSquare</span><span class="p">(</span><span class="nv">SquareByRows</span><span class="p">),</span><span class="ss">nl</span><span class="p">,!.</span>


<span class="ss">squareByRows</span><span class="p">(</span><span class="nv">_</span><span class="p">,[],[]):-!.</span>
<span class="ss">squareByRows</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="nv">Vars</span><span class="p">,[</span><span class="nv">Row</span><span class="p">|</span><span class="nv">SquareByRows</span><span class="p">]):-</span> <span class="ss">append</span><span class="p">(</span><span class="nv">Row</span><span class="p">,</span><span class="nv">Vars1</span><span class="p">,</span><span class="nv">Vars</span><span class="p">),</span> <span class="ss">length</span><span class="p">(</span><span class="nv">Row</span><span class="p">,</span><span class="nv">N</span><span class="p">),</span> <span class="ss">squareByRows</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="nv">Vars1</span><span class="p">,</span><span class="nv">SquareByRows</span><span class="p">),!.</span>

<span class="ss">writeSquare</span><span class="p">(</span><span class="nv">Square</span><span class="p">):-</span> <span class="ss">member</span><span class="p">(</span><span class="nv">Row</span><span class="p">,</span><span class="nv">Square</span><span class="p">),</span> <span class="ss">nl</span><span class="p">,</span> <span class="ss">member</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="nv">Row</span><span class="p">),</span> <span class="ss">write4</span><span class="p">(</span><span class="nv">N</span><span class="p">),</span> <span class="ss">fail</span><span class="p">.</span>
<span class="ss">writeSquare</span><span class="p">(</span><span class="nv">_</span><span class="p">).</span>

<span class="ss">write4</span><span class="p">(</span><span class="nv">N</span><span class="p">):-</span> <span class="nv">N</span><span class="o">&lt;</span><span class="m">10</span><span class="p">,</span>   <span class="ss">write</span><span class="p">(</span><span class="ss">'   '</span><span class="p">),</span> <span class="ss">write</span><span class="p">(</span><span class="nv">N</span><span class="p">),!.</span>
<span class="ss">write4</span><span class="p">(</span><span class="nv">N</span><span class="p">):-</span> <span class="nv">N</span><span class="o">&lt;</span><span class="m">100</span><span class="p">,</span>  <span class="ss">write</span><span class="p">(</span><span class="ss">'  '</span> <span class="p">),</span> <span class="ss">write</span><span class="p">(</span><span class="nv">N</span><span class="p">),!.</span>
<span class="ss">write4</span><span class="p">(</span><span class="nv">N</span><span class="p">):-</span>         <span class="ss">write</span><span class="p">(</span><span class="ss">' '</span>  <span class="p">),</span> <span class="ss">write</span><span class="p">(</span><span class="nv">N</span><span class="p">),!.</span>

<span class="ss">exprSuma</span><span class="p">([</span><span class="nv">X</span><span class="p">],</span> <span class="nv">X</span><span class="p">).</span>
<span class="ss">exprSuma</span><span class="p">([</span><span class="nv">X</span><span class="p">|</span><span class="nv">L</span><span class="p">],</span> <span class="nv">X</span> <span class="o">+</span> <span class="nv">Expr</span><span class="p">)</span> <span class="p">:-</span> <span class="ss">exprSuma</span><span class="p">(</span><span class="nv">L</span><span class="p">,</span> <span class="nv">Expr</span><span class="p">).</span>

<span class="ss">constraintsSum</span><span class="p">(</span> <span class="nv">_</span><span class="p">,</span> <span class="p">[]).</span>
<span class="ss">constraintsSum</span><span class="p">(</span> <span class="nv">Sum</span><span class="p">,</span> <span class="p">[</span><span class="nv">CR</span> <span class="p">|</span> <span class="nv">CRL</span><span class="p">])</span> <span class="p">:-</span> <span class="ss">exprSuma</span><span class="p">(</span><span class="nv">CR</span><span class="p">,</span> <span class="nv">Suma</span><span class="p">),</span> <span class="nv">Suma</span> <span class="o">#=</span> <span class="nv">Sum</span><span class="p">,</span> <span class="ss">constraintsSum</span><span class="p">(</span><span class="nv">Sum</span><span class="p">,</span> <span class="nv">CRL</span><span class="p">).</span>
</code></pre>
                </div>
            </div>

            <p>
                En aquest problema hem de posar tots el nombres entre
                <strong>1</strong> i <strong>N^2</strong> en un quadrat de
                <strong>N x N</strong> complint les següents restriccions:
            </p>

            <ul>
                <li>
                    <p>
                        han de estar tots els nombres, i no hi pot haver
                        repetits òbviament,
                    </p>
                </li>
                <li>
                    <p>
                        cada fila i columna ha de sumar la mateixa quantitat que
                        és:
                        <strong>(N + N*N*N) / 2</strong>.
                    </p>
                </li>
            </ul>

            <p>Per a fer-ho seguim la següent estructura:</p>

            <ol>
                <li>
                    <p>
                        <strong>Definim el domini de les variables</strong>: Ho
                        fem en la línea:
                        <code class="language-plaintext highlighter-rouge"
                            >Vars ins 1..NSquare</code
                        >
                    </p>
                </li>
                <li>
                    <p>
                        <strong>Definim les constriccions</strong>: La primera
                        restricció es la de
                        <code class="language-plaintext highlighter-rouge"
                            >all_distinct(Vars)</code
                        >
                        que imposa que cap variable pugui tenir el mateix valor,
                        i elimina els valor dels dominis en cas que sigui
                        possible. Després, ens ajudem dels predicats
                        <code class="language-plaintext highlighter-rouge"
                            >squareByRows</code
                        >
                        i
                        <code class="language-plaintext highlighter-rouge"
                            >transpose</code
                        >
                        per obtenim la matriu en llistes de llistes, les quals
                        recorrem amb el predicat
                        <code class="language-plaintext highlighter-rouge"
                            >contraintsSum</code
                        >
                        i imposem que l’expressió que suma tots els elements de
                        cada fila i columna sigui igual (<code
                            class="language-plaintext highlighter-rouge"
                            >#=</code
                        >) a el valor que ens diu l’enunciat.
                        <code class="language-plaintext highlighter-rouge"
                            >exprSuma</code
                        >
                        retorna una expressió que representa la suma dels valors
                        d’una llista.
                    </p>
                </li>
                <li>
                    <p>
                        <strong
                            >Fem el
                            <code class="language-plaintext highlighter-rouge"
                                >label</code
                            ></strong
                        >
                    </p>
                </li>
                <li>
                    <p><strong>Imprimim el resultat</strong></p>
                </li>
            </ol>

            <hr />

            <h2 id="altres-exercicis-dexamens-passats">
                Altres exercicis d’examens passats
            </h2>

            <p><strong>politician.pl</strong></p>

            <div class="language-prolog highlighter-rouge">
                <div class="highlight">
                    <pre
                        class="highlight"
                    ><code><span class="c1">%% Elections are coming!  A politician wants to do a road trip starting and finishing at city 1, driving in</span>
<span class="c1">%% total at most MaxKm kilometers, and visiting at least N cities (city 1 and N-1 different other ones),</span>
<span class="c1">%% without passing twice through the same city!  Complete the following predicate politician(N,MaxKm,Trip),</span>


<span class="c1">% road(A-B,K) means there is a road from A to B (or vice versa) of length K km.</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">1</span><span class="o">-</span><span class="m">3</span><span class="p">,</span> <span class="m">3</span>  <span class="p">).</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">1</span><span class="o">-</span><span class="m">6</span><span class="p">,</span> <span class="m">25</span> <span class="p">).</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">2</span><span class="o">-</span><span class="m">3</span><span class="p">,</span> <span class="m">41</span> <span class="p">).</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">2</span><span class="o">-</span><span class="m">4</span><span class="p">,</span> <span class="m">31</span> <span class="p">).</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">2</span><span class="o">-</span><span class="m">5</span><span class="p">,</span> <span class="m">7</span>  <span class="p">).</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">2</span><span class="o">-</span><span class="m">6</span><span class="p">,</span> <span class="m">7</span>  <span class="p">).</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">3</span><span class="o">-</span><span class="m">4</span><span class="p">,</span> <span class="m">32</span> <span class="p">).</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">4</span><span class="o">-</span><span class="m">7</span><span class="p">,</span> <span class="m">14</span> <span class="p">).</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">4</span><span class="o">-</span><span class="m">8</span><span class="p">,</span> <span class="m">29</span> <span class="p">).</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">5</span><span class="o">-</span><span class="m">6</span><span class="p">,</span> <span class="m">36</span> <span class="p">).</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">5</span><span class="o">-</span><span class="m">7</span><span class="p">,</span> <span class="m">45</span> <span class="p">).</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">5</span><span class="o">-</span><span class="m">8</span><span class="p">,</span> <span class="m">22</span> <span class="p">).</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">6</span><span class="o">-</span><span class="m">8</span><span class="p">,</span> <span class="m">11</span> <span class="p">).</span>
<span class="ss">road</span><span class="p">(</span> <span class="m">7</span><span class="o">-</span><span class="m">8</span><span class="p">,</span> <span class="m">44</span> <span class="p">).</span>

<span class="ss">road1</span><span class="p">(</span><span class="nv">A</span><span class="o">-</span><span class="nv">B</span><span class="p">,</span><span class="nv">K</span><span class="p">):-</span> <span class="ss">road</span><span class="p">(</span><span class="nv">A</span><span class="o">-</span><span class="nv">B</span><span class="p">,</span><span class="nv">K</span><span class="p">).</span>
<span class="ss">road1</span><span class="p">(</span><span class="nv">B</span><span class="o">-</span><span class="nv">A</span><span class="p">,</span><span class="nv">K</span><span class="p">):-</span> <span class="ss">road</span><span class="p">(</span><span class="nv">A</span><span class="o">-</span><span class="nv">B</span><span class="p">,</span><span class="nv">K</span><span class="p">).</span>


<span class="ss">politician</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span><span class="nv">MaxKm</span><span class="p">,</span><span class="nv">Trip</span><span class="p">):-</span>     <span class="ss">path</span><span class="p">(</span><span class="nv">N</span><span class="p">,</span> <span class="nv">MaxKm</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="p">[],</span> <span class="nv">Trip</span><span class="p">).</span>

<span class="c1">% path( NumCitiesRemainingToBeVisited, RemainingKm, CurrentCity, CitiesAlreadyVisited, Path )</span>

<span class="ss">path</span><span class="p">(</span> <span class="m">0</span><span class="p">,</span> <span class="nv">_</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="nv">_</span><span class="p">,</span> <span class="p">[]</span> <span class="p">):-</span> <span class="p">!.</span>
<span class="ss">path</span><span class="p">(</span> <span class="nv">NumCitiesRemainingToBeVisited</span><span class="p">,</span> <span class="nv">RemainingKm</span><span class="p">,</span> <span class="nv">CurrentCity</span><span class="p">,</span> <span class="nv">CitiesAlreadyVisited</span><span class="p">,</span> <span class="p">[</span><span class="nv">CurrentCity1</span><span class="p">|</span><span class="nv">Path</span><span class="p">]</span> <span class="p">):-</span>
  <span class="ss">road1</span><span class="p">(</span> <span class="nv">CurrentCity</span><span class="o">-</span><span class="nv">CurrentCity1</span><span class="p">,</span> <span class="nv">K</span> <span class="p">),</span>
  <span class="err">\</span><span class="o">+</span> <span class="ss">member</span><span class="p">(</span><span class="nv">CurrentCity1</span><span class="p">,</span> <span class="nv">CitiesAlreadyVisited</span><span class="p">),</span>
  <span class="nv">NewN</span> <span class="ss">is</span> <span class="nv">NumCitiesRemainingToBeVisited</span> <span class="o">-</span> <span class="m">1</span><span class="p">,</span>
  <span class="nv">NewRmKm</span> <span class="ss">is</span> <span class="nv">RemainingKm</span> <span class="o">-</span> <span class="nv">K</span><span class="p">,</span>
  <span class="nv">NewRmKm</span> <span class="o">&gt;=</span> <span class="m">0</span><span class="p">,</span>
  <span class="ss">path</span><span class="p">(</span> <span class="nv">NewN</span><span class="p">,</span> <span class="nv">NewRmKm</span><span class="p">,</span> <span class="nv">CurrentCity1</span><span class="p">,</span> <span class="p">[</span><span class="nv">CurrentCity1</span><span class="p">|</span><span class="nv">CitiesAlreadyVisited</span><span class="p">],</span> <span class="nv">Path</span><span class="p">).</span>

<span class="c1">%% Examples: this main writes the six trips below (in some order):</span>

<span class="ss">main</span><span class="p">:-</span> <span class="ss">politician</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="nv">Trip</span><span class="p">),</span>   <span class="ss">write</span><span class="p">([</span><span class="m">1</span><span class="p">|</span><span class="nv">Trip</span><span class="p">]),</span> <span class="ss">nl</span><span class="p">,</span> <span class="ss">fail</span><span class="p">.</span>
<span class="ss">main</span><span class="p">:-</span> <span class="ss">politician</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="m">120</span><span class="p">,</span><span class="nv">Trip</span><span class="p">),</span>   <span class="ss">write</span><span class="p">([</span><span class="m">1</span><span class="p">|</span><span class="nv">Trip</span><span class="p">]),</span> <span class="ss">nl</span><span class="p">,</span> <span class="ss">fail</span><span class="p">.</span>
<span class="ss">main</span><span class="p">:-</span> <span class="ss">halt</span><span class="p">.</span>

<span class="c1">%% [1,3,4,8,6,1]</span>
<span class="c1">%% [1,3,4,2,6,1]</span>
<span class="c1">%% [1,6,8,4,3,1]</span>
<span class="c1">%% [1,6,2,4,3,1]</span>
<span class="c1">%% [1,3,2,5,8,6,1]</span>
<span class="c1">%% [1,6,8,5,2,3,1]</span>
</code></pre>
                </div>
            </div>

            <blockquote>
                <p>
                    <img
                        class="emoji"
                        title=":warning:"
                        alt=":warning:"
                        src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png"
                        height="20"
                        width="20"
                    />
                    <strong
                        >És molt important en <em>PROLOG</em> no oblidar mai que
                        no estem programant imperativament, sino que estem
                        definint predicats, i que ha de passar per a que siguin
                        certs</strong
                    >
                </p>
            </blockquote>
        </main>
    </div>
    <script>
        // Select all headers within the main content
        var headers = document.querySelectorAll(
            ".main-content h1, .main-content h2, .main-content h3, .main-content h4, .main-content h5, .main-content h6"
        );

        // Select the table of contents
        var tableOfContents = document.getElementById("table-of-contents");

        // Initialize the previous header level to 6 (the highest possible header level)
        var previousHeaderLevel = 6;

        // Regular expression to match a number at the start of the header text
        var numberRegex = /\d+\./g;

        // Loop through each header
        for (var i = 0; i < headers.length; i++) {
            // Get the current header level
            var currentHeaderLevel = parseInt(headers[i].tagName.substring(1));

            // Get the text of the header
            var headerText = headers[i].textContent;
            headerText = headerText.replace(numberRegex, function (match) {
                return "<strong>" + match + "</strong>";
            });

            // Create a new anchor element
            var anchor = document.createElement("a");

            // Set the href attribute to the ID of the corresponding header
            anchor.href = "#" + headers[i].id;

            // Create a new paragraph element
            var paragraph = document.createElement("p");

            // Set the class of the paragraph element based on the header level
            paragraph.className =
                "sidebar-item-" + headers[i].tagName.toLowerCase();

            // Set the HTML of the paragraph element to the header text
            paragraph.innerHTML = headerText;

            // Append the paragraph element to the anchor element
            anchor.appendChild(paragraph);

            // Append the anchor element to the table of contents
            tableOfContents.appendChild(anchor);

            // Add click event listener to scroll to the corresponding header
            anchor.addEventListener("click", function (event) {
                event.preventDefault();
                var targetId = this.getAttribute("href").substring(1);
                var targetElement = document.getElementById(targetId);
                targetElement.scrollIntoView({ behavior: "smooth" });
            });

            // Update the previous header level
            previousHeaderLevel = currentHeaderLevel;
        }
    </script>
    <script>
        btSwitch = document.getElementById("theme-switcher")
        btSwitch.addEventListener("click", function () {
                var body = document.body;
                if (body.classList.contains("light")) {
                    body.classList.remove("light");
                    body.classList.add("dark");
                } else {
                    body.classList.remove("dark");
                    body.classList.add("light");
                }
            });
    </script>
</body>
